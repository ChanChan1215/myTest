import pandas as pd
import re  # 匯入正規表達式模組
# import opencc

# 【替換】設定檔案路徑，請改成你的檔案路徑
file_path = r'C:\Users\user\Desktop\lol_claer\fileLOLdiam\fileLOLjungle.csv'

# 讀取 CSV 檔案成 DataFrame
df = pd.read_csv(file_path)

# 確認原始資料的行數
print(f"原始資料行數：{len(df)}")

# # 建立簡體轉繁體轉換器
# converter = opencc.OpenCC('s2t')

# # 把欄位名稱做簡轉繁
# df.columns = [converter.convert(col) for col in df.columns]

# # 把英雄名稱欄位裡的簡體字轉成繁體
# df['英雄名稱'] = df['英雄名稱'].apply(converter.convert)

# 國服(簡體) -> 台服(繁體) 英雄名稱對照字典
cn_to_tw_name_map = {
    '德玛西亚之力': '蓋倫',
    '正义天使': '凱爾',
    '齐天大圣': '悟空',
    '暮光之眼': '慎',
    '炼金术士': '辛吉德',
    '暗夜猎手': '汎',
    '狂战士': '歐拉夫',
    '迅捷斥候': '提摩',
    '狂暴之心': '凱能',
    '迷失之牙': '吶兒',
    '暗裔剑魔': '厄薩斯',
    '武器大师': '賈克斯',
    '祖安狂人': '蒙多醫生',
    '青钢影': '卡蜜兒',
    '腕豪': '賽特',
    '圣锤之毅': '波比',
    '符文法师': '雷茲',
    '刀锋舞者': '伊瑞莉雅',
    '无双剑姬': '菲歐拉',
    '蛮族之王': '泰達米爾',
    '铁铠冥魂': ' 魔鬥凱薩',
    '荒漠屠夫': '雷尼克頓 ',
    '无畏战车': '烏爾加特',
    '亡灵战神': '賽恩',
    '沙漠死神': '納瑟斯',
    '诺克萨斯之手': '達瑞斯',
    '深海泰坦': '納帝魯斯',
    '德玛西亚皇子': '嘉文四世',
    '熔岩巨兽': '墨菲特',
    '未来守护者': '杰西',
    '疾风剑豪': '犽宿',
    '猩红收割者': '弗拉迪米爾 ',
    '放逐之刃': '雷玟',
    "灵罗娃娃":"關",
    "山隐之焰":"鄂爾",
    "机械公敌":"藍寶",
    "不灭狂雷":"弗力貝爾",
    "封魔剑魂":"犽凝",
    "祖安怒兽":"沃里克",
    "暮光星灵":"柔依",
    "血港鬼影":"派克",
    "诺克萨斯统领":"諾克薩斯",
    "大发明家":"漢默丁格",
    "黑暗之女":"安妮",
    "英勇投弹手":"庫奇",
    "邪恶小法师":"維迦",
    "冰霜女巫":"麗珊卓",
    "不祥之刃":"卡特蓮娜",
    "九尾妖狐":"阿璃",
    "虚空行者":"卡薩丁",
    "暗黑元首":"辛德拉",
    "正义巨像":"加里歐",
    "堕落天使":"魔甘娜",
    "潮汐海灵":"飛斯",
    "复仇焰魂":"布蘭德",
    "发条魔灵":"奧莉安娜",
    "爆破鬼才":"希格斯",
    "奥术先驱":"奧術",
    "愁云使者":"薇可絲",
    "卡牌大师":"逆命",
    "离群之刺":"阿卡莉",
    "光辉女郎":"拉克絲",
    "荆棘之兴":"枷蘿",
    "时间刺客":"艾克",
    "皎月女神":"黛安娜",
    "铸星龙王":"奧瑞利安",
    "影流之主":"劫",
    "赏金猎人":"好運姐",
    "探险家":"伊澤瑞爾",
    "瘟疫之源":"圖奇",
    "惩戒之箭":"法洛士",
    "戏命师":"燼",
    "荣耀行刑官":"達瑞文",
    "暴走萝莉":"金克絲",
    "沙漠玫瑰":"煞蜜拉",
    "麦林炮手":"崔絲塔娜",
    "寒冰射手":"艾希",
    "皮城女警":"凱特琳",
    "圣枪游侠":"路西恩",
    "战争女神":"希維爾",
    "复仇之矛":"克黎思妲",
    "虚空之女":"卡莎",
    "逆羽":"剎雅",
    "祖安花火":"婕莉",
    "星籁歌姬":"瑟菈紛",
    "蒸汽机器人":"布里茨",
    "扭曲树精":"茂凱",
    "天启者":"卡爾瑪",
    "琴瑟仙女":"琴仙索娜",
    "众星之子":"索拉卡",
    "明烛":"米利歐",
    "唤潮鲛姬":"娜米",
    "风暴之怒":"迦娜",
    "曙光女神":"蕾歐娜",
    "牛头酋长":"亞歷斯塔",
    "仙灵女巫":"露璐",
    "涤魂圣枪":"姍娜",
    "魔法猫咪":"悠咪",
    "魂锁典狱长":"錘石",
    "殇之木乃伊":"阿姆姆",
    "永恒梦魇":"夜曲",
    "披甲龙龟":"拉姆斯",
    "含羞蓓蕾":"莉莉亞",
    "雪原双子":"努努和威朗普",
    "枪火狂徒":"格雷福斯",
    "永猎双子":"鏡爪",
    "远古恐惧":"費德提克",
    "龙血武姬":"希瓦娜",
    "影流之镰":"慨影",
    "德邦总管":"趙信",
    "不屈之枪":"潘森",
    "无极剑圣":"易大師",
    "虚空掠夺者":"卡兹克",
    "铁血狼母":"安比薩",
    "皮城执法官":"菲艾",
    "傲之追猎者":"雷恩加爾",
    "战争之影":"赫克林",
    "刀锋之影":"泰隆",
    "痛苦之拥":"伊芙琳",
    "破败之王":"不滅狂雷",
    "盲僧":"李星",
    
    
    

}

# 去除空白字符並確保大小寫一致性
df['英雄名稱'] = df['英雄名稱'].str.strip()  # 去除前後空格
# 用字典做名稱替換，若對照字典中找不到則保留原名稱
df['英雄名稱'] = df['英雄名稱'].apply(lambda x: cn_to_tw_name_map.get(x, x))

# 定義一個用 regex 處理百分比字串的函式
def percent_to_float_regex(x):
    # 如果是空值或 NaN，直接回傳 None
    if pd.isna(x):
        return None
    # 使用 regex 找出字串中數字和小數點的部分，忽略 % 和空白
    match = re.search(r'(\d+\.?\d*)', x)
    if match:
        # 找到後轉成浮點數並除以 100
        return float(match.group(1)) / 100
    else:
        # 若沒找到數字，回傳 None
        return None

# 用 regex 函式，將勝率、登場率、Ban率轉成浮點數
df['勝率'] = df['勝率'].apply(percent_to_float_regex)
df['登場率'] = df['登場率'].apply(percent_to_float_regex)
df['Ban率'] = df['Ban率'].apply(percent_to_float_regex)

# 檢查是否有重複的英雄名稱，若有會印出重複項
duplicate_heroes = df[df.duplicated(subset=['英雄名稱'], keep=False)]
if not duplicate_heroes.empty:
    print("發現重複英雄名稱：")
    print(duplicate_heroes)
    # 刪除重複的英雄名稱，只保留第一個
    df = df.drop_duplicates(subset=['英雄名稱'], keep='first')
else:
    print("沒有發現重複的英雄名稱")

# 檢查勝率、登場率、Ban率是否有超出合理範圍（0~1之外）的數值
for col in ['勝率', '登場率', 'Ban率']:
    invalid_values = df[(df[col] < 0) | (df[col] > 1)]
    if not invalid_values.empty:
        print(f"在欄位 {col} 中發現異常數值：")
        print(invalid_values[['英雄名稱', col]])
    else:
        print(f"欄位 {col} 中沒有異常數值")

# 確認清理後的資料行數
print(f"清理後資料行數：{len(df)}")

# 最後印出清理後的資料
print(df)
